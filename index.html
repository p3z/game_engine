<html>
  <head>
    <link rel="stylesheet" href="./css/global.css">
    <link rel="stylesheet" href="./css/utils.css">
    <link rel="stylesheet" href="./css/backgrounds.css">
    <link rel="stylesheet" href="./css/animations.css">
    <link rel="stylesheet" href="./css/style.css">
    
    
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  </head>
  <body>
    <div class="control_panel">
        <button class="js-run_test dev-btn">
            Run test
        </button>
      
      <button class="js-reset dev-btn">
            Reset
       </button>

       <button class="js-clear-canvas hide dev-btn">
        Clear
      </button>

       <button class="js-test dev-btn">
            Test
       </button>
    </div> <!-- end control panel-->
    <div id="main_view"></div>


    <div class="scoreboard ui-board hide">
      <span class="js-score"></span>
    </div>


    <div class="lifeboard ui-board hide">
      <div class="lifeboard-meter1" data-value="100"></div>
      <img class="lifeboard-avatar hide" src="./img/rocket-icon.png" >
      &nbsp; x &nbsp;
      <span class="js-lives"></span>
    </div>

    <!-- todo: audio elements suffice for now but shd probs use a library -->
    <audio class="js-backing-track">
      <source src="./audio/track1.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <audio class="js-projectile-track-1">
      <source src="./audio/laser_1.wav" type="audio/wav">
      Your browser does not support the audio element.
    </audio>
    
    <!-- Temp do this inline to avoid p5/module weirdness -->

       <!-- utils.js -->
       <script>
        function random_num(floor, ceil){
  
  return Math.floor(Math.random() * (ceil - floor + 1) + floor);
  
  } // end random_num
  
  // Returns an array of rgba color objects
  function random_rgba(qty = 1, solid = false){
  
    let colors = [];
    
    for(let i = 0; i < qty; i++){
    
        let color = {};
    
        let r = random_num(0, 255);
        let g = random_num(0, 255);
        let b = random_num(0, 255);
        let a = random_num(0, 100) / 100;
    
        let val = (!solid) ? `rgba(${r}, ${g}, ${b}, ${a})` : `rgba(${r}, ${g}, ${b})`;
    
        colors.push(val);
    }
    
    return colors;
  
  }
  
  function random_hex(with_hash = false){
  const letters = '0123456789ABCDEF';
  let color = with_hash ? '#' : '';
  
  for (let i = 0; i < 6; i++) {
      color += letters[Math.floor(Math.random() * 16)];
  }
  
  return color;
  }
  
  function rand_arr_select(arr){
  const index = Math.floor(Math.random() * arr.length);
  return arr[index];
  }
      </script>

    <!-- settings.js -->
    <script>
      const MAX_STAR_THRESHOLD = 100;
      const MIN_STAR_SIZE = 1;
      const MAX_STAR_SIZE = 8;
      const MIN_PLANET_SIZE = 20;
      const MAX_PLANET_SIZE = 50;
      const MAX_STAR_SPARSITY = 100;
      const DEFAULT_SPEED = random_num(100, 500);
      const PLANET_PASSING_THRESHOLD = 3; // out of 100 stars, this is the % chance it'll be a planet instead (3% is the usual setting)
      const STAR_COLORS = [
        '#FFFFFF', // white
        '#FFFFCC', // pale yellow
        '#FFFF99', // light yellow
        '#FFFF66', // yellow
        '#E6E6E6', // light gray
        '#CCCCCC', // gray
        '#99CCFF', // light blue
        '#66CCFF', // blue
        '#FF99CC', // light pink
        '#FF66CC'  // pink
      ];

      const PLANET_COLORS = [
        "#F0A1A1", // Pinkish
        "#A1F0A1", // Greenish
        "#A1A1F0", // Bluish
        "#F0F0A1", // Yellowish
        "#DAA520"  // Goldenrod
      ];
    </script>

 

<!-- assorted -->
<script>
  function select_spawn_point(view, location = []){
    let view_width = view.clientWidth;
    let view_height = view.clientHeight;
    
    
    let x_loc, y_loc;
    
    if(location.length == 0){
      // No location specified, Pick a random place between each end of the view
      x_loc = random_num(0, view_width);
      y_loc = random_num(0, view_height);
      
    } else {
      // Assign one of the selected locations
      x_loc = location[0];
      y_loc = location[1];
    }

    let spawn_point = {
      x_loc: x_loc,
      y_loc: y_loc
    };
    
    //console.log(spawn_point)
    
    return spawn_point;
  }
</script>

<!-- main -->
    <script>
      const run_test_btn = document.querySelector('.js-run_test');
      const reset_btn = document.querySelector('.js-reset');
      const test_btn  = document.querySelector('.js-test');
      const main_view = document.querySelector('#main_view');
      const clear_canvas_btn = document.querySelector(".js-clear-canvas");
      const origin = -100; // above the top of the canvas so things can animate in


      run_test_btn.addEventListener('click', function() {
        init_canvas()
      });

      function init_canvas() { // dont call it 'setup', you'll conflict with p5 defaults and invoke it immediately!
          let canvas = createCanvas(windowWidth, windowHeight);          
          background(0);
          canvas.parent('main_view'); 
          
          clear_canvas_btn.classList.remove("hide");
      }

 

      reset_btn.onclick = () => {
        reset_view()
        clear_canvas_btn.classList.add("hide");
      }

      function generate_star(){

        let star_size = random_num(MIN_STAR_SIZE, MAX_STAR_SIZE);        
        
        let new_star = {
            x: random(width), 
            y: -star_size, // spawn it above the canvas
            size: star_size,
            speed: random_num(0, 10),
            color: rand_arr_select(STAR_COLORS)
          };

          return new_star;

      }

      function animate_stars(){   

          for (let i = stars.length - 1; i >= 0; i--) {

            let cur_star = stars[i];            
            cur_star.y += cur_star.speed; // Move the star downwards

            fill(cur_star.color); // Set the fill color to the star's color
            noStroke();            
            ellipse(cur_star.x, cur_star.y, cur_star.size, cur_star.size); // Draw the star

            // Remove stars that have moved off the canvas
            if (cur_star.y > height + cur_star.size / 2) {
              stars.splice(i, 1);
            }

          }

        }
        
      
      test_btn.onclick = () => {
        
      }

      clear_canvas_btn.onclick = () => {
        background(0); // Clear the canvas by setting the background color
      }

      function reset_view() {
        main_view.innerHTML = "";
      }

  

      let stars = [];
      let planets = [];
      

      function get_percentage(num, percentage){
        return num / 100 * percentage;
      }
      

      function draw() {
          
        background(0); // Clear the background

        let sparsity = random_num(0, MAX_STAR_SPARSITY); // decide if we should spawn a star this frame

        if (sparsity < get_percentage(MAX_STAR_SPARSITY, 50)) {
          
          // let star_qty = random_num(0 ,3); // if we want to create more than one star per frame

          // for(let i = 0; i < star_qty; i++){
            let new_star = generate_star();
            stars.push(new_star);
          //}
        
          
        }
        
        animate_stars();
    
        
  
          
      }


       //ellipse(mouseX, mouseY, 80, 80);

            // squares
            // let side = 100; // Side length of the square
            // rect(mouseX, mouseY, side, side);
            
            // triangles
            //let side = 50;

            // Calculate the coordinates of the triangle's vertices around the mouse position
            // let x1 = mouseX; // Vertex 1
            // let y1 = mouseY - (sqrt(3) / 3) * side;
            // let x2 = mouseX - side / 2; // Vertex 2
            // let y2 = mouseY + (sqrt(3) / 6) * side;
            // let x3 = mouseX + side / 2; // Vertex 3
            // let y3 = mouseY + (sqrt(3) / 6) * side;

            // // Draw the equilateral triangle
            // triangle(x1, y1, x2, y2, x3, y3);

        



    </script>
  </body>
</html>